---
import { getCollection } from "astro:content";
import Article from "@components/Article.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import Cover from "@components/Cover.astro";

export async function getStaticPaths() {
  const photos = await getCollection("photos");
  return photos.map((photo) => ({
    params: { slug: photo.id },
    props: { photo },
  }));
}

const { photo } = Astro.props;
const photos = (await getCollection("photos")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);
const index = photos.findIndex((other) => other.id === photo.id);
const formatted_date = photo.data.date.toLocaleDateString("en-US", {
  month: "long",
  day: "numeric",
  year: "numeric",
});
---

<BaseLayout
  tab="photos"
  title={photo.data.title}
  description={photo.data.description}
  keywords={photo.data.keywords}
>
  <div class="flex flex-col items-center gap-8 lg:gap-20">
    <Cover
      image={photo}
      previous={index > 0 && `./${photos[index - 1].id}`}
      next={index >= 0 &&
        index < photos.length - 1 &&
        `./${photos[index + 1].id}`}
      action_href={photo.data.cover.src}
      action_download={`${photo.id}.jpg`}
      action_icon="/icons/link-download.svg"
      action_alt="Download photo in full size"
      className=""
    />
    <Article title={photo.data.title} className="">
      <table>
        <tr><th>Date</th><td>{formatted_date}</td></tr>
        <tr><th>Location</th><td>{photo.data.location}</td></tr>
        <tr><th>City</th><td>{photo.data.city}</td></tr>
        <tr><th>State/Region</th><td>{photo.data.state}</td></tr>
        <tr><th>Country</th><td>{photo.data.country}</td></tr>
        <tr><th>Camera</th><td>{photo.data.camera}</td></tr>
        <tr><th>Lens</th><td>{photo.data.lens}</td></tr>
        <tr><th>Editing</th><td>{photo.data.editing}</td></tr>
        <tr
          ><th>License</th><td
            ><a href={photo.data.license_url}>{photo.data.license_name}</a></td
          ></tr
        >
        <tr
          ><th>Attribution</th><td
            ><a href={photo.data.attribution_url}
              >{photo.data.attribution_name}</a
            ></td
          ></tr
        >
      </table>
    </Article>
  </div>
</BaseLayout>
