name: Push

on:
  push:
    branches: [main]

concurrency: live

jobs:
  preview:
    uses: ./.github/workflows/ci.yml
    with:
      environment: preview
    secrets: inherit

  live:
    needs: preview
    uses: ./.github/workflows/ci.yml
    with:
      environment: live
      container: ${{ needs.preview.outputs.container }}
      artifact: ${{ needs.preview.outputs.artifact }}
      deploy_args: --prod
    secrets: inherit
